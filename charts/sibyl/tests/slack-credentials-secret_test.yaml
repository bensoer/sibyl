suite: slack-credentials-secret
templates:
  - templates/slack-credentials-secet.yaml
tests:
  - it: should create a secret by default
    set:
      slack:
        channel: "my-channel"
        botToken: "my-token"
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-sibyl-slack-credentials
      - equal:
          path: stringData.SLACK_CHANNEL
          value: "my-channel"
      - equal:
          path: stringData.SLACK_BOT_TOKEN
          value: "my-token"

  - it: should not create a secret when useExistingSecret is enabled
    set:
      slack:
        useExistingSecret:
          enabled: true
    asserts:
      - hasDocuments:
          count: 0
